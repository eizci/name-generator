<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.3.0/milligram.min.css"/>
<style>
.divider{
    top: 0;
    right : 0;
    position: absolute;
    cursor: col-resize;
    background-color:#efe6e673;
    user-select: none;    
}
th.sorted, th.asorted{
    color:black;
}
th{
    min-width:50px;
}
th:hover{
    cursor: pointer;
}
th:hover::after, th.asorted:hover::after, th.sorted::after{
    content: "▲";
}
th.sorted:hover::after, th.asorted::after{
    content: "▼";
}
</style>
</head>
<body>
    <div class="container">
        <table id="table_id">
        </table>    
    </div>

  <script>
    function getElementIndex(el) {
        if (!el) return -1;
        var i = -1;
        do {
            i++;
        } while (el = el.previousElementSibling);
        return i;
    }

    function sortRows(els, idx, sorted){
        console.log(idx)
        var direction = sorted? 1: -1
        for(var i=0;i<els.length;i++){
            if(isNaN(els[i].children[idx].innerText)){
                els.sort(function(a,b){
                    return a.children[idx].innerHTML.toLowerCase() > b.children[idx].innerHTML.toLowerCase() ? direction : direction*-1
                })
                return els
            }
        }
        console.log('all numbers')
        els.sort(function(a,b){
            return parseInt(a.children[idx].innerText) > parseInt(b.children[idx].innerText) ? direction : direction*-1
        })
        return els
    }
    
    function setDelimiterListeners(div){
        var pageX,currentCol,nextCol,currentColWidth,nextColWidth;
        div.addEventListener('mousedown', function (e) {
            currentCol = e.target.parentElement;
            nextCol = currentCol.nextElementSibling;
            pageX = e.pageX;
            currentColWidth = currentCol.offsetWidth
            if (nextCol){
                nextColWidth = nextCol.offsetWidth
            }
        });

        document.addEventListener('mousemove', function (e) {
            div.style.height = div.closest("table").offsetHeight + 'px'
            if (currentCol) {
                var diffX = e.pageX - pageX
                currentCol.style.width = (currentColWidth + diffX)+'px'               
                if (nextCol){
                    nextCol.style.width = (nextColWidth - (diffX))+'px'
                }
            }
        })

        document.addEventListener('mouseup', function (e) { 
            currentCol = undefined
            nextCol = undefined
        })
    }
    function createDivider(height, width){
        var div = document.createElement('div')
        div.className = 'divider'
        div.style.height = height+'px'
        div.style.width = width+'px'
        return div
    }
    function toggleSorted(el){
        var headers = el.parentElement.children
        for(var i=0;i<headers.length;i++){
            if(headers[i] != el){
                headers[i].className = ''
            }
        }
        if(el.className == 'sorted'){
            el.className = 'asorted'
        }else{
            el.className = 'sorted'
        }
    }
    function fillinTable(json, table){
        var thead = document.createElement('thead')
        var tbody = document.createElement('tbody')
        var hrow = document.createElement("tr")
        table.appendChild(thead)
        table.appendChild(tbody)
        thead.appendChild(hrow)
        
        for(var i=0;i<json.columns.length;i++){
            headerText = document.createTextNode(json.columns[i])
            header = document.createElement("th")
            header.appendChild(headerText)
            header.addEventListener('click', function(e){
                if(e.target.tagName != "TH"){
                    return
                }
                toggleSorted(this)
                var idx = getElementIndex(this)
                var elements = [].slice.call(tbody.children)
                while(tbody.childElementCount >1){
                    tbody.deleteRow(1)
                }
                elements  = sortRows(elements, idx, this.className=="sorted")
                for(i=0;i<elements.length;i++){
                    tbody.appendChild(elements[i])
                }
            })
            hrow.appendChild(header)
        }
        
        for(var i=0;i<json.rows.length;i++){
            var row = document.createElement("tr")
            for(var j=0;j<json.rows[i].length;j++){
                td = document.createElement("td")
                text = document.createTextNode(json.rows[i][j])
                td.appendChild(text)
                row.appendChild(td)
            }
            tbody.appendChild(row)
        }
    }

    function loadTable( tableId, json={'columns':['empty'], 'rows':[]}, delimiterWidth=6) {
        var table = document.getElementById(tableId)
        table.innerHTML = ""
        fillinTable(json, table)
        var row = table.getElementsByTagName('tr')[0]
        cols = row ? row.children : undefined
        if (!cols) return;
        for (var i=0;i<cols.length;i++){
            var div = createDivider(table.offsetHeight, delimiterWidth)
            cols[i].appendChild(div)
            cols[i].style.position = 'relative'
            setDelimiterListeners(div)
        }
    }
    var json = {"columns": ["id", "company", "contact", "country"], 
                "rows": [[2, "Alfreds Futterkistes", "Maria Anders", "united kingdom"], 
                        [1,"Alfreds Futterkiste", "Maria Anders", "united kingdom"], 
                        [3,"Berglunds snabbköp", "Christina Berglund", "Sweden"], 
                        [4,"Centro comercial Moctezuma", "Francisco Chang", "Mexico"], 
                        [6, "Ernst Handel", "Roland Mendel", "Austria"], 
                        [7, "Island Trading", "Helen Bennett", "UK"], 
                        [11, "Königlich Essen", "aPhilip Cramer", "Germany"], 
                        [14, "Laughing Bacchus Winecellars", "Yoshi Tannamuri", "Canada"], 
                        [22, "bMagazzini Alimentari Riuniti", "Giovanni Rovelli", "Italy"]] }
    loadTable('table_id', json, 6)
  </script>
</body>
</html>
